[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Project",
  "enabled": 1,
  "modified": "2025-12-06 12:37:15.349384",
  "module": "Frappe Project",
  "name": "Project Tasks Dashboard",
  "script": "frappe.ui.form.on('Project', {\r\n    refresh: function(frm) {\r\n        // Check if the custom section is already rendered to prevent duplicates\r\n        if (frm.fields_dict['todo_section']) {\r\n            frm.set_df_property('todo_section', 'hidden', 0);\r\n            return;\r\n        }\r\n\r\n        // 1. Define the section where the ToDos will appear\r\n        frm.add_custom_button(__('Project ToDos'), () => {\r\n            frappe.set_route('List', 'ToDo', {'project': frm.doc.name});\r\n        }, __('View'));\r\n\r\n        // 2. Add a new section below the main fields\r\n        frm.add_custom_ui_section = function() {\r\n            // Add a Column Break and a Section Break for the list view container\r\n            frm.add_fetch_list_container = frm.add_section(\r\n                __('Project Tasks'), \r\n                'todo_section'\r\n            );\r\n        };\r\n        frm.add_custom_ui_section();\r\n\r\n        // 3. Define the list rendering function\r\n        function render_todos() {\r\n            // Remove previous content before rendering\r\n            $(frm.add_fetch_list_container.wrapper).empty();\r\n\r\n            frappe.call({\r\n                method: \"frappe.client.get_list\",\r\n                args: {\r\n                    doctype: \"ToDo\",\r\n                    filters: {\r\n                        // Filter by the new custom link field you added\r\n                        \"project\": frm.doc.name, \r\n                        \"docstatus\": 0,\r\n                        \"status\": [\"!=\", \"Done\"] // Only show Open tasks\r\n                    },\r\n                    fields: [\"name\", \"description\", \"status\", \"priority\", \"date\"],\r\n                    order_by: \"priority DESC, date ASC\",\r\n                    limit: 10\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message && r.message.length) {\r\n                        // Render the list using the standard Frappe list view engine\r\n                        let $list = frappe.render_list(\r\n                            \"ToDo\", \r\n                            r.message, \r\n                            frm.add_fetch_list_container.wrapper\r\n                        );\r\n\r\n                        // Add headers\r\n                        $list.prepend(\r\n                            `<div class=\"list-row list-row-head text-muted\">\r\n                                <div class=\"col-xs-4\">Description</div>\r\n                                <div class=\"col-xs-2\">Priority</div>\r\n                                <div class=\"col-xs-3\">Status</div>\r\n                                <div class=\"col-xs-2\">Due Date</div>\r\n                            </div>`\r\n                        );\r\n                    } else {\r\n                        $(frm.add_fetch_list_container.wrapper).html(\r\n                            `<p class=\"text-muted small\">${__('No open ToDos linked to this project.')}</p>`\r\n                        );\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // Render the list when the form refreshes\r\n        render_todos();\r\n    }\r\n});",
  "view": "Form"
 }
]